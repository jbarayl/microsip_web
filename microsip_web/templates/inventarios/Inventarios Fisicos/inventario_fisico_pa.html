{% extends "inventarios/base.html" %}
{% block title %}Inicio{% endblock %}

<!-- CSS Code -->
{% block style_css %}{% endblock %}

<!-- JavaScript Code -->
{% block js_code %}
<script src="{{ STATIC_URL }}admin/js/admin/RelatedObjectLookups.js"></script>


<script type="text/javascript">
  $(function() {
    $( "#id_fecha" ).datepicker({dateFormat:'dd/mm/yy',});
  });
   
   
  $(document).ready(function(){
    

    $('#id_clave').live('keydown', function(e) { 
      var keyCode = e.keyCode || e.which; 

      if (keyCode == 13 || keyCode == 9) 
      { 
        if($("#id_clave").val() != '')
          Dajaxice.microsip_web.apps.ventas.get_articulo_by_clave(mostrar_articulo,{'clave': $('#id_clave').val(),});
        return false
      }

    });

    
    if ($('#id_modo_rapido').attr('checked'))  
      $("#id_clave").focus();
    else
      $("#id_articulo_text").focus();

    $("#id_articulo").change(function(){
      if ($("#id_articulo").children().length > 0)
        Dajaxice.microsip_web.apps.ventas.get_articulosen_inventario(mostrar_unidades,{'inventario_id': {{ InventarioFisico.id }},'articulo_id':$('#id_articulo option:selected').val()});
      else
        $('#span_alerta_unidades').html('');
    });
    

    $('#btnCancel').on('click', function () {
      $("#myModal input").val()='';
    });

    $('#myModal').on('shown', function () {
      $("#myModal input").first().focus();
        alert ('ya'+$("#myModal input").first().vlaue());
    });

    
    {% if formset.total_form_count > 0 %} 
      
      if ($('form > .errorlist').length == 0)
        $('#myModal').modal();
        $("#myModal input").first().focus();
    {% endif %}
  });

  function mostrar_articulo(data){
    if (data.articulo_id != 0)
    {
      $('#id_articulo-deck').attr('style','');
      $('#id_articulo-deck').html('<span class="div hilight" data-value="'+data.articulo_id+'"><span style="display: inline;" class="remove div">X</span>'+data.articulo_nombre+'</span>');
      $('#id_articulo').html('<option selected="selected" value="'+data.articulo_id+'"></option>');
      $('#id_articulo_text').hide();

      Dajaxice.microsip_web.apps.ventas.get_articulosen_inventario(mostrar_unidades,{'inventario_id': {{ InventarioFisico.id }},'articulo_id':$('#id_articulo option:selected').val()});
      
    }
     else
    {

      $('#id_articulo_text').attr('style','');
      $('#id_articulo-deck').html('');
      $('#id_articulo').html('');
      $('#id_articulo_text').show(); 
      alert('No existe ningun articulo con la clave ['+ $("#id_clave").val() +']');
      $("#id_clave").focus();
      $("#id_clave").select();

    }
  }


  function mostrar_unidades(data) 
  {
    if (data.unidades > 0 )
      $('#span_alerta_unidades').html(' Ya existen '+ data.unidades + ' en inventario.');
    else
      $('#span_alerta_unidades').html('');

    $("#id_unidades").focus();
  }

</script>



{% endblock %}
{% block breadcrumb %}{{ block.super }} <a href="/inventarios/InventariosFisicos/">Inventarios Fisico</a> <i class=" icon-play"></i> Inventario Fisico a apuerta abierta{% endblock %}
{% block content %}
<form method="post" class="form-horizontal" action="" width="300px"  enctype='multipart/form-data'>
  {% if message %}
  <div class="alert alert-block alert-error fade in">
    <button type="button" class="close" data-dismiss="alert">×</button>
    <h4 class="alert-heading">Oh NO! Ocurio un error!</h4>
    <p>{{ message }}</p>
  </div>
  {% endif %}
  <div class="ms-custom-form" style=" height: 5em; ">
    <div class='span'>
      <h3 class='span'>Inventario Fisico 
        <ul class="nav btn btn-mini" style=" margin: 0px; ">
          <li class="dropdown">
            <a id="drop1" href="#" role="button" class="dropdown-toggle" data-toggle="dropdown"> <i class="icon-cog"></i></a>
            <ul class="dropdown-menu" role="menu" aria-labelledby="drop1" style='text-align:left;'>
              <li><a tabindex="-1" href="/inventarios/InventarioFisico_pa/agregar_articulos_nocontabilizados/{{ inventario_id }}"><i class="icon-ok-circle"></i> Agregar articulos no contabilizados</a></li>
            </ul>
          </li>
        <ul>
      </h3>
    </div>
    
    <div class=" pull-right ms-form-right-detail">
      <div class="span2" >
        <label>Fecha</label>
        <div class="input-prepend input-append">
          {{ InventarioFisico.fecha }} 
        </div>
      </div> 
      <div class="span2" >
        <label>Folio</label>
        <div class="input-prepend input-append">
          {{ InventarioFisico.folio }} 
        </div>
      </div>  
    </div>
    <div style='clear:both;'>
      <div class='span' style="font-size:.7em; margin-left: 4em; ">
        {{ inventario_form.errors }}
        {{ inventario_form.modo_rapido }} Modo Rapido
      </div>
      <div  class=" pull-right ">
        <div class="span4">
          <strong>Alamacen: </strong> {{ InventarioFisico_form.almacen }} {{ InventarioFisico.almacen }} 
        </div>
      </div>  
    </div>
  </div>
  {% csrf_token %}
  
  <div id="myModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    {{ formset.management_form }}
    {{ formset.non_field_errors }}
    <div class="modal-header">
      {% if msg_series %}
      <div class="alert alert-block alert-error fade in">
        <button type="button" class="close" data-dismiss="alert">×</button>
        <p>{{ msg_series }}</p>
      </div>
      {% endif %}
      <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
      <h3 id="myModalLabel">Numeros de Series</h3>
    </div>
    <div class="modal-body">
      <table class="table tableCell table-hover tablesorter" id="id_numeros_serie" border="0" cellpadding="0" cellspacing="1">
        <thead>
          <tr>
            <th >Claves o Numeros de series</th>
            <th></th>
          </tr>
        </thead>
        <tbody id="sortable">
          {% for form in formset.forms %}
          <tr id="{{ form.prefix }}-row" class="form-container">
              {% for hid in form.hidden_fields %} {{hid}}{% endfor %} 
              <td>{{ form.clave }}</td>
              <td>
                {% if not inicio_form %}
                    <div class="text-error">
                      {{ form.errors }}
                    </div>
                {%  endif %}
              </td>
          </tr>
          {% endfor %}
       </tbody>
     </table>
    </div>
    <div class="modal-footer">
      <button class="btn" id='btnCancel' data-dismiss="modal">Cancelar</button>
      <button type="submit" class="btn" name='add_button'>Aceptar</button>
    </div>
  </div>
  

  {{ detalleInvForm.errors }}
  <div class="span" >
    <div class="input-prepend input-append">
      {{ detalleInvForm.clave }}
    </div>
  </div>
  <div class="span" >
    <div class="input-prepend input-append">
      {{ detalleInvForm.articulo }}
      <span id='span_alerta_unidades' class="text-error" style=" background-color: rgb(255, 255, 0); "> </span>
    </div>
  </div>
  <div class="span1" >
    <div class="input-prepend input-append">
      {{ detalleInvForm.unidades }}
    </div>
  </div>
  <div class="span" >
      <button type="submit" class="btn" name='add_button'>Enviar</button>
      <!-- <button type="submit" class="btn" name='minus_button'><i class="icon-minus-sign"></i></button> -->
  </div>
  <br style='clear:both;'>
  <br>
  <table class="table tableCell table-hover">
    <tr>
      <th>Articulo</th>
      <th>Unidades</th>
    </tr>
  {% for detalle in detallesInventario %}
    <tr>
      <td> {{ detalle.articulo }} </td>
      <td> {{ detalle.unidades }} </td>
    </tr>
  {% endfor %}
  </table>
  
</form>

{% include 'autocomplete_light/static.html' %}
{% endblock %}